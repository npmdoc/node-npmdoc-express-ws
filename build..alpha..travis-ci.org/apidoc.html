<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/HenningM/express-ws"

    >express-ws (v3.0.0)</a>
</h1>
<h4>WebSocket endpoints for Express applications</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-ws">module express-ws</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-ws.express-ws">
            function <span class="apidocSignatureSpan"></span>express-ws
            <span class="apidocSignatureSpan">(app, httpServer)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">express-ws.</span>add_ws_method</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">express-ws.</span>trailing_slash</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">express-ws.</span>websocket_url</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">express-ws.</span>wrap_middleware</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-ws.add_ws_method">module express-ws.add_ws_method</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-ws.add_ws_method.default">
            function <span class="apidocSignatureSpan">express-ws.add_ws_method.</span>default
            <span class="apidocSignatureSpan">(target)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-ws.trailing_slash">module express-ws.trailing_slash</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-ws.trailing_slash.default">
            function <span class="apidocSignatureSpan">express-ws.trailing_slash.</span>default
            <span class="apidocSignatureSpan">(string)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-ws.websocket_url">module express-ws.websocket_url</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-ws.websocket_url.default">
            function <span class="apidocSignatureSpan">express-ws.websocket_url.</span>default
            <span class="apidocSignatureSpan">(url)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-ws.wrap_middleware">module express-ws.wrap_middleware</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-ws.wrap_middleware.default">
            function <span class="apidocSignatureSpan">express-ws.wrap_middleware.</span>default
            <span class="apidocSignatureSpan">(middleware)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-ws" id="apidoc.module.express-ws">module express-ws</a></h1>


    <h2>
        <a href="#apidoc.element.express-ws.express-ws" id="apidoc.element.express-ws.express-ws">
        function <span class="apidocSignatureSpan"></span>express-ws
        <span class="apidocSignatureSpan">(app, httpServer)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function expressWs(app, httpServer) {
  var options = arguments.length &#x3e; 2 &#x26;&#x26; arguments[2] !== undefined ? arguments[2] : {};

  var server = httpServer;

  if (server === null || server === undefined) {
<span class="apidocCodeCommentSpan">    /* No HTTP server was explicitly provided, create one for our Express application. */
</span>    server = _http2.default.createServer(app);

    app.listen = function serverListen() {
      var _server;

      return (_server = server).listen.apply(_server, arguments);
    };
  }

  /* Make our custom `.ws` method available directly on the Express application. You should
   * really be using Routers, though. */
  (0, _addWsMethod2.default)(app);

  /* Monkeypatch our custom `.ws` method into Express&#x27; Router prototype. This makes it possible,
   * when using the standard Express Router, to use the `.ws` method without any further calls
   * to `makeRouter`. When using a custom router, the use of `makeRouter` may still be necessary.
   *
   * This approach works, because Express does a strange mixin hack - the Router factory
   * function is simultaneously the prototype that gets assigned to the resulting Router
   * object. */
  if (!options.leaveRouterUntouched) {
    (0, _addWsMethod2.default)(_express2.default.Router);
  }

  // allow caller to pass in options to WebSocketServer constructor
  var wsOptions = options.wsOptions || {};
  wsOptions.server = server;
  var wsServer = new _ws2.default.Server(wsOptions);

  wsServer.on(&#x27;connection&#x27;, function (socket) {
    var request = socket.upgradeReq;

    request.ws = socket;
    request.wsHandled = false;

    /* By setting this fake `.url` on the request, we ensure that it will end up in the fake
     * `.get` handler that we defined above - where the wrapper will then unpack the `.ws`
     * property, indicate that the WebSocket has been handled, and call the actual handler. */
    request.url = (0, _websocketUrl2.default)(request.url);

    var dummyResponse = new _http2.default.ServerResponse(request);

    dummyResponse.writeHead = function writeHead(statusCode) {
      if (statusCode &#x3e; 200) {
        /* Something in the middleware chain signalled an error. */
        socket.close();
      }
    };

    app.handle(request, dummyResponse, function () {
      if (!request.wsHandled) {
        /* There was no matching WebSocket-specific route for this request. We&#x27;ll close
         * the connection, as no endpoint was able to handle the request anyway... */
        socket.close();
      }
    });
  });

  return {
    app: app,
    getWss: function getWss() {
      return wsServer;
    },
    applyTo: function applyTo(router) {
      (0, _addWsMethod2.default)(router);
    }
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-ws.add_ws_method" id="apidoc.module.express-ws.add_ws_method">module express-ws.add_ws_method</a></h1>


    <h2>
        <a href="#apidoc.element.express-ws.add_ws_method.default" id="apidoc.element.express-ws.add_ws_method.default">
        function <span class="apidocSignatureSpan">express-ws.add_ws_method.</span>default
        <span class="apidocSignatureSpan">(target)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addWsMethod(target) {
<span class="apidocCodeCommentSpan">  /* This prevents conflict with other things setting `.ws`. */
</span>  if (target.ws === null || target.ws === undefined) {
    target.ws = function addWsRoute(route) {
      for (var _len = arguments.length, middlewares = Array(_len &#x3e; 1 ? _len - 1 : 0), _key = 1; _key &#x3c; _len; _key++) {
        middlewares[_key - 1] = arguments[_key];
      }

      var wrappedMiddlewares = middlewares.map(_wrapMiddleware2.default);

      /* We append `/.websocket` to the route path here. Why? To prevent conflicts when
       * a non-WebSocket request is made to the same GET route - after all, we are only
       * interested in handling WebSocket requests.
       *
       * Whereas the original `express-ws` prefixed this path segment, we suffix it -
       * this makes it possible to let requests propagate through Routers like normal,
       * which allows us to specify WebSocket routes on Routers as well \o/! */
      var wsRoute = (0, _websocketUrl2.default)(route);

      /* Here we configure our new GET route. It will never get called by a client
       * directly, it&#x27;s just to let our request propagate internally, so that we can
       * leave the regular middleware execution and error handling to Express. */
      this.get.apply(this, _toConsumableArray([wsRoute].concat(wrappedMiddlewares)));

      /*
       * Return `this` to allow for chaining:
       */
      return this;
    };
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-ws.trailing_slash" id="apidoc.module.express-ws.trailing_slash">module express-ws.trailing_slash</a></h1>


    <h2>
        <a href="#apidoc.element.express-ws.trailing_slash.default" id="apidoc.element.express-ws.trailing_slash.default">
        function <span class="apidocSignatureSpan">express-ws.trailing_slash.</span>default
        <span class="apidocSignatureSpan">(string)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addTrailingSlash(string) {
  var suffixed = string;
  if (suffixed.charAt(suffixed.length - 1) !== &#x27;/&#x27;) {
    suffixed = suffixed + &#x27;/&#x27;;
  }
  return suffixed;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-ws.websocket_url" id="apidoc.module.express-ws.websocket_url">module express-ws.websocket_url</a></h1>


    <h2>
        <a href="#apidoc.element.express-ws.websocket_url.default" id="apidoc.element.express-ws.websocket_url.default">
        function <span class="apidocSignatureSpan">express-ws.websocket_url.</span>default
        <span class="apidocSignatureSpan">(url)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function websocketUrl(url) {
  if (url.indexOf(&#x27;?&#x27;) !== -1) {
    var _url$split = url.split(&#x27;?&#x27;),
        _url$split2 = _slicedToArray(_url$split, 2),
        baseUrl = _url$split2[0],
        query = _url$split2[1];

    return (0, _trailingSlash2.default)(baseUrl) + &#x27;.websocket?&#x27; + query;
  }
  return (0, _trailingSlash2.default)(url) + &#x27;.websocket&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-ws.wrap_middleware" id="apidoc.module.express-ws.wrap_middleware">module express-ws.wrap_middleware</a></h1>


    <h2>
        <a href="#apidoc.element.express-ws.wrap_middleware.default" id="apidoc.element.express-ws.wrap_middleware.default">
        function <span class="apidocSignatureSpan">express-ws.wrap_middleware.</span>default
        <span class="apidocSignatureSpan">(middleware)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function wrapMiddleware(middleware) {
  return function (req, res, next) {
    if (req.ws !== null &#x26;&#x26; req.ws !== undefined) {
      req.wsHandled = true;
      try {
<span class="apidocCodeCommentSpan">        /* Unpack the `.ws` property and call the actual handler. */
</span>        middleware(req.ws, req, next);
      } catch (err) {
        /* If an error is thrown, let&#x27;s send that on to any error handling */
        next(err);
      }
    } else {
      /* This wasn&#x27;t a WebSocket request, so skip this middleware. */
      next();
    }
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
